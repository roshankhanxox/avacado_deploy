#!/bin/bash

# Script to execute a withdraw intent using cast
# Usage: ./execute-intent.sh [private_key] [rpc_url]

if [ $# -lt 1 ]; then
    echo "Usage: $0 <private_key> [rpc_url]"
    echo "Example: $0 0x1234... https://api.avax-test.network/ext/bc/C/rpc"
    exit 1
fi

PRIVATE_KEY=$1
RPC_URL=${2:-"https://api.avax-test.network/ext/bc/C/rpc"}
CONTRACT_ADDRESS="0x5894792d827D56057718Ca15B266D1A7C4eb3682"

# Intent parameters from submitWithdrawIntent
INTENT_HASH="0x2e065e4f7a54404201986d974bad5046e9b0b7f7751f9d72cf34d17832062f8a"
TOKEN_ID="0"
DESTINATION="0xe87758C6CCcf3806C9f1f0C8F99f6Dcae36E5449"
AMOUNT="100"
NONCE="1"

# Proof data
PROOF_A1="0x085f2478f1f5a0f46829666c83f8f4a3ff3f77fce74f99ea6e81b0dbc892f3d5"
PROOF_A2="0x0ce1a2e4d6b8a21107f913f197d2e2d1a6b439d20bc005f3acde53da0838e075"
PROOF_B11="0x13095f338b22f5e58765361cdbfc1ade9cea0fbd79a2f42c4e1b67dace88596f"
PROOF_B12="0x0bb394ba29b8db83ac25b16837322104bfeafde5d0b0c3a45877a566a64331a6"
PROOF_B21="0x06e1bf37aae8cda91d5412f0a7bef20dcac5889ec9099061935a89995c2d3592"
PROOF_B22="0x0eef3e0857da6306246ffecf05a2590e902b97023c76a77215dce04a627adb03"
PROOF_C1="0x0a41b45dec668d49853532167564607d4898fb6d39e30576f7c54474c5591c50"
PROOF_C2="0x11e9b13cc86e55a2b0200dad49b7e6e1234ccaae98ca1d971e2841f5fc71237c"

# Balance PCT array
BALANCE_PCT_0="17352110474724567082361631892925420909322146885620482922156939108759948382252"
BALANCE_PCT_1="3512150847074577377027456211152587417595631771146930264176196131848718382368"
BALANCE_PCT_2="10772574538802446951063213353134820816568682609001825210862972561334538414584"
BALANCE_PCT_3="11318130424932288151026291345954722069787832684012342918655115122067483965256"
BALANCE_PCT_4="1596191388890136692565135072296584069635999791698211771422035297945440501838"
BALANCE_PCT_5="3876552429372531642216703127478082748907237726622260974590532729947539017539"
BALANCE_PCT_6="133705180971420892029465340865676915084"

INTENT_METADATA="0x"

echo "Executing withdraw intent..."
echo "Intent Hash: $INTENT_HASH"
echo "Token ID: $TOKEN_ID"
echo "Destination: $DESTINATION"
echo "Amount: $AMOUNT"
echo "Nonce: $NONCE"
echo "RPC URL: $RPC_URL"
echo "Contract: $CONTRACT_ADDRESS"
echo ""

# Execute the transaction
cast send $CONTRACT_ADDRESS \
    "executeWithdrawIntent(bytes32,uint256,address,uint256,uint256,((uint256[2],uint256[2][2],uint256[2]),uint256[16]),uint256[7],bytes)" \
    $INTENT_HASH \
    $TOKEN_ID \
    $DESTINATION \
    $AMOUNT \
    $NONCE \
    "([$PROOF_A1,$PROOF_A2],[[[$PROOF_B11,$PROOF_B12],[$PROOF_B21,$PROOF_B22]]],[$PROOF_C1,$PROOF_C2])" \
    "[$BALANCE_PCT_0,$BALANCE_PCT_1,$BALANCE_PCT_2,$BALANCE_PCT_3,$BALANCE_PCT_4,$BALANCE_PCT_5,$BALANCE_PCT_6]" \
    $INTENT_METADATA \
    --private-key $PRIVATE_KEY \
    --rpc-url $RPC_URL \
    --gas-limit 5000000